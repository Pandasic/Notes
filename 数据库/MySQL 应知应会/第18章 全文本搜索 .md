---
title: 第18章 全文本搜索 
tag: [计算机课程学习,数据库,MySQL 应知应会,]
---
> **第18章 全文本搜索 .md**
>
> **全文本搜索**

- LIKE 和 REFEXP 的局限性

  -   性能

  -   必须 明确控制

  -   不能 智能化的结果

- **FULLTEXT** 用来指定全文本搜素并进行索引

  -   用于创建/更改表的时候

  -   MySQL 在CRUD的时候自动更新

- 进行全文本搜素、

- *例*

- SELECT note\_text\

  > FROM productnotes\
  > WHERE Match(note\_text) Against(\'rabbit\');

- 其中**Match()** 用于指定被搜索的列，**Against()**指定要使用的搜索表达式【除非使用BINARY方式 否则不区分大小写】。传递给Match()的值必须与FULLTEXT()定义相同。如果指定多个列，则必须列出它们。

- Match(col) Against(val); 返回的是一个排序等级。不匹配为0。

- [[拓展查询]{.underline}](https://dev.mysql.com/doc/refman/8.0/en/fulltext-query-expansion.html) **WITH QUERY EXPANSION**

- 查找关键词以及其相关的词汇 依赖于语言设置

- *例*

- SELECT note\_text\

  > FROM productnotes\
  > WHERE Match(note\_text)Against(\'anvils\'WITH QUERY EXPANSTON);

- 布尔文本搜索 **IN BOOLEAN MODE**

  -   要匹配的词;

  -   要排斥的词(如果某行包含这个词，则不返回该行，即使它包含其他指定的词也是如此);

  -   排列提示(指定某些词比其他词更重要，更重要的词等级更高);

  -   表达式分组;

  -   另外一些内容。

- *例*

- SELECT note\_text\

  > FROM productnotes\
  > WHERE Match(note\_text)Against(\'heavy -rope\*\'IN BOOLEAN MODE);\
  > \#查询heavy 但是排除了rope\*

+----------------+--------------------------------------------------------------------------------+
| -   布尔操作符 | -   说明                                                                       |
                                                                                                 
+================+================================================================================+
| -   \+         | -   包含，词必须存在                                                           |
+----------------+--------------------------------------------------------------------------------+
| -   \-         | -   排除，词必须不出现                                                         |
+----------------+--------------------------------------------------------------------------------+
| -   \>         | -   包含，而且增加等级值                                                       |
+----------------+--------------------------------------------------------------------------------+
| -   \<         | -   包含，且减少等级值                                                         |
+----------------+--------------------------------------------------------------------------------+
| -   ()         | -   把词组成子表达式（允许这些子表达式作为一个组被包含、排除、排列等）         |
+----------------+--------------------------------------------------------------------------------+
| -   \_         | -   取消一个词的排序值                                                         |
+----------------+--------------------------------------------------------------------------------+
| -   \*         | -   词尾的通配符                                                               |
+----------------+--------------------------------------------------------------------------------+
| -   \"\"       | -   定义一个短语（与单个词的列表不一样，它匹配整个短语以便包含或排除这个短语） |
+----------------+--------------------------------------------------------------------------------+

- SELECT note\_text\

  > FROM productnotes\
  > WHERE Match(note\_text)Against(\'+rabbit +bait\'IN BOOLEAN MODE)\
  > \#这个搜索匹配包含词rabbit和bait的行。\
  > SELECT note\_text\
  > FROM productnotes\
  > WHERE Match(note\_text)Against(\'rabbit bait\'IN BOOLEAN MODE);\
  > \#没有指定操作符，这个搜索匹配包含rabbit和bait中的至少一个词的行。\
  > SELECT note\_text\
  > FROM productnotes\
  > WHERE Match(note\_text)Against(\'\"rabbit bait\"\'IN BOOLEAN MODE);\
  > \#这个搜索匹配短语rabbit bait而不是匹配两个词rabbit和bait。\
  > SELECT note\_text\
  > FROM productnotes\
  > WHERE Match(note\_text)Against(\'\>rabbit \<carrot\'IN BOOLEAN MODE);\
  > \#匹配rabbit和carrot，增加前者的等级，降低后者的等级。\
  > SELECT note\_text\
  > FROM productnotes\
  > WHERE Match(note\_text)Against(\'+safe +(\<combination)\'IN BOOLEAN MODE);\
  > \#这个搜索匹配词safe和combination，降低后者的等级。

- **说明**

  -   在索引全文本数据时，短词被忽略且从索引中排除。短词定义为那些具有3个或3个以下字符的词（如果需要，这个数目可以更改）。

  -   MySQL带有一个内建的非用词（stopword）列表，这些词在索引全文本数据时总是被忽略。如果需要，可以覆盖这个列表（请参阅MySQL文档以了解如何完成此工作）。

  -   许多词出现的频率很高，搜索它们没有用处（返回太多的结果）。\

> 因此，MySQL规定了一条50%规则，如果一个词出现在50%以上的行中，则将它作为一个非用词忽略。50%规则不用于IN BOOLEAN MODE。

-   如果表中的行数少于3行，则全文本搜索不返回结果（因为每个词或者不出现，或者至少出现在50%的行中）。

-   忽略词中的单引号。例如，don\'t索引为dont。

-   不具有词分隔符（包括日语和汉语）的语言不能恰当地返回全文本搜索结果。

    -   如前所述，仅在MyISAM数据库引擎中支持全文本搜索。

 